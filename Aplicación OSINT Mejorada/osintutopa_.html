<!DOCTYPE html>
		<html lang="es">
		<head><link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Amarante&family=Big+Shoulders+Stencil:opsz,wght@10..72,100..900&family=Birthstone&family=Ephesis&family=Grandiflora+One&family=Gwendolyn:wght@400;700&family=Julius+Sans+One&family=Love+Light&family=Matangi:wght@300..900&family=Savate:ital,wght@0,200..900;1,200..900&family=WDXL+Lubrifont+JP+N&family=WDXL+Lubrifont+SC&family=WindSong:wght@400;500&family=Zen+Loop:ital@0;1&display=swap" rel="stylesheet">
			<body>
			<header>
			  <h1>OSINT Utopia</h1>
			  <nav>
			<ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="recursos.html">Recursos</a></li>
          <li><a href="deinteres.html">De Interés</a></li>
          <li><a href="links.html">Links</a></li>
        </ul>
      </nav>
      <button id="dark-mode-toggle">🌙 Modo Oscuro</button>
    </header>
    <main>
      <h2>Recursos OSINT</h2>
      <p>
        Aquí encontrarás herramientas y bases de datos útiles para la
        investigación OSINT.
      </p>
      <ul id="resources-list">
        <!-- Se llenará dinámicamente con JS -->
      </ul>
    </main>
    <footer>
      <p>&copy; 2025 OSINT Utopia | Seguridad y Privacidad</p>
    </footer>
	
	
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recursos - OSINT Utopia</title>
    <link rel="stylesheet" href="styles.css" />
    <script defer src="script.js"></script>
	<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Documentos Legales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Personalización de Tailwind CSS para ajustar a preferencias de tema claro */
        :root {
            --tw-bg-opacity: 1;
            --tw-bg-color: #f9fafb;
            --tw-text-opacity: 1;
            --tw-text-color: #374151;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-600">
    <div class="container mx-auto p-4 pt-6 md:p-6 lg:p-12">
        <div class="header bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold mb-4">📄 Analizador de Documentos Legales</h1>
            <p class="text-lg">Análisis inteligente de documentos con IA jurídica</p>
        </div>

        <div class="nav-tabs flex flex-wrap justify-center mb-6">
            <button class="nav-tab active bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2 mb-2" onclick="showTab('upload')">📁 Subir Documentos</button>
            <button class="nav-tab bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2 mb-2" onclick="showTab('analyze')">🔍 Análisis</button>
            <button class="nav-tab bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2 mb-2" onclick="showTab('reports')">📊 Informes</button>
            <button class="nav-tab bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-2" onclick="showTab('memory')">💾 Memoria</button>
        </div>

        <!-- Tab: Upload -->
        <div id="upload" class="tab-content active p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">📁 Subida de Documentos</h2>
            
            <div class="upload-area bg-gray-200 rounded-lg p-6 mb-6 cursor-pointer" onclick="document.getElementById('fileInput').click()">
                <div class="text-5xl mb-4">📄</div>
                <h3 class="text-lg font-bold mb-2">Arrastra archivos aquí o haz clic para seleccionar</h3>
                <p class="text-gray-600">Soporta: PDF, DOCX, XLSX, CSV, JSON, JS, JPG, PNG</p>
                <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,.docx,.xlsx,.csv,.json,.js,.jpg,.png">
            </div>

            <div class="export-options flex justify-center mb-6">
                <button class="btn btn-primary bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="document.getElementById('folderInput').click()">
                    📁 Subir Carpeta Completa
                </button>
                <input type="file" id="folderInput" class="file-input" webkitdirectory multiple>
                <button class="btn btn-success bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="processFiles()">
                    🚀 Procesar Archivos
                </button>
                <button class="btn btn-warning bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded" onclick="clearFiles()">
                    🗑️ Limpiar Lista
                </button>
            </div>

            <div id="fileList" class="file-list"></div>
        </div>

        <!-- Tab: Analyze -->
        <div id="analyze" class="tab-content p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">🔍 Análisis de Documentos</h2>
            
            <div id="analysisResults"></div>
            
            <div class="analysis-section p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">📋 Lista de Verificación</h3>
                <div id="checklistResults"></div>
            </div>

            <div class="analysis-section p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">⚖️ Marco Legal</h3>
                <div id="legalFramework"></div>
            </div>

            <div class="analysis-section p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">📈 Timeline de Documentos</h3>
                <div id="timeline" class="timeline"></div>
            </div>
        </div>

        <!-- Tab: Reports -->
        <div id="reports" class="tab-content p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">📊 Generación de Informes</h2>
            
            <div class="summary-card p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">📝 Resumen Ejecutivo</h3>
                <div id="executiveSummary"></div>
                
                <div class="export-options flex justify-center mt-4">
                    <button class="btn btn-primary bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="exportToPDF('summary')">
                        📄 Exportar PDF
                    </button>
                    <button class="btn btn-success bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" onclick="exportToWord('summary')">
                        📝 Exportar DOCX
                    </button>
                </div>
            </div>

            <div class="summary-card p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">📋 Informe Detallado</h3>
                <div id="detailedReport"></div>
                
                <div class="export-options flex justify-center mt-4">
                    <button class="btn btn-primary bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="exportToPDF('detailed')">
                        📄 Exportar PDF
                    </button>
                    <button class="btn btn-success bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" onclick="exportToWord('detailed')">
                        📝 Exportar DOCX
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab: Memory -->
        <div id="memory" class="tab-content p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">💾 Memoria y Base de Conocimientos</h2>
            
            <div class="summary-card p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">🧠 Memoria de Documentos</h3>
                <div id="documentMemory"></div>
                
                <div class="export-options flex justify-center mt-4">
                    <button class="btn btn-primary bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="exportMemoryJSON()">
                        💾 Exportar JSON
                    </button>
                    <button class="btn btn-success bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" onclick="loadMemoryJSON()">
                        📂 Cargar Memoria
                    </button>
                    <input type="file" id="memoryInput" class="file-input" accept=".json">
                </div>
            </div>

            <div class="summary-card p-6 bg-gray-200 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-2">📚 Librería de Conocimientos</h3>
                <div id="knowledgeBase" class="json-viewer"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let uploadedFiles = [];
        let analysisResults = {};
        let documentMemory = {};
        let knowledgeBase = {};

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadStoredMemory();
        });

        function setupEventListeners() {
            // Drag and drop
            const uploadArea = document.querySelector('.upload-area');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // File inputs
            document.getElementById('fileInput').addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            document.getElementById('folderInput').addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            document.getElementById('memoryInput').addEventListener('change', (e) => {
                loadMemoryFromFile(e.target.files[0]);
            });
        }

        function showTab(tabName) {
            // Ocultar todas las tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar tab seleccionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (!uploadedFiles.find(f => f.name === file.name && f.size === file.size)) {
                    uploadedFiles.push(file);
                }
            });
            displayFileList();
        }

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileType = getFileType(file.name);
                const fileIcon = getFileIcon(fileType);
                
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${fileIcon} ${file.name}</div>
                        <div class="file-details">
                            Tipo: ${fileType} | Tamaño: ${formatFileSize(file.size)} | 
                            Modificado: ${new Date(file.lastModified).toLocaleString()}
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="removeFile(${index})">❌</button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayFileList();
        }

        function clearFiles() {
            uploadedFiles = [];
            displayFileList();
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                'pdf': 'PDF',
                'docx': 'Word',
                'doc': 'Word',
                'xlsx': 'Excel',
                'xls': 'Excel',
                'csv': 'CSV',
                'json': 'JSON',
                'js': 'JavaScript',
                'jpg': 'Imagen',
                'jpeg': 'Imagen',
                'png': 'Imagen'
            };
            return types[ext] || 'Desconocido';
        }

        function getFileIcon(type) {
            const icons = {
                'PDF': '📄',
                'Word': '📝',
                'Excel': '📊',
                'CSV': '📋',
                'JSON': '🔧',
                'JavaScript': '💻',
                'Imagen': '🖼️'
            };
            return icons[type] || '📎';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function processFiles() {
            if (uploadedFiles.length === 0) {
                alert('Por favor, sube al menos un archivo.');
                return;
            }

            showLoadingState();
            
            try {
                for (let file of uploadedFiles) {
                    await analyzeFile(file);
                }
                
                generateAnalysisResults();
                generateReports();
                updateMemory();
                
                // Cambiar a la tab de análisis
                showTab('analyze');
                document.querySelector('[onclick="showTab(\'analyze\')"]').click();
                
            } catch (error) {
                console.error('Error procesando archivos:', error);
                showAlert('Error al procesar archivos: ' + error.message, 'danger');
            } finally {
                hideLoadingState();
            }
        }

        async function analyzeFile(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    const analysis = performAnalysis(file, content);
                    analysisResults[file.name] = analysis;
                    resolve(analysis);
                };
                
                if (file.type.includes('text') || file.name.endsWith('.json') || file.name.endsWith('.js')) {
                    reader.readAsText(file);
                } else {
                    // Para archivos binarios, simular extracción de texto
                    reader.readAsArrayBuffer(file);
                    setTimeout(() => {
                        const simulatedText = simulateTextExtraction(file);
                        const analysis = performAnalysis(file, simulatedText);
                        analysisResults[file.name] = analysis;
                        resolve(analysis);
                    }, 1000);
                }
            });
        }

        function simulateTextExtraction(file) {
            // Simulación de extracción de texto para diferentes tipos de archivo
            const fileType = getFileType(file.name);
            
            const sampleTexts = {
                'PDF': 'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas. Instrumento que pos su naturaleza, se tienen por sensibles los datos de identificacion, domicilio y demas informacion que no se considera relevante transcribir en este analisis, de conformidad a la ley que regula la materia.
                
                'Word': 'Escrito legal de continuidad procesal y que por su contenido, se actua  en caracter de abogado patrono y autorizados\n\nC. Juez:\n\nComaprecemos ante usted a efecto de señalar que en: [FECHA], la cual hemos analizado detenidamente.\n\nTras estudiar y tras estudiar el razonamielo logico juridico que enma del acuerdo que hace referencia, manifestamos:\n\n1. Plazo de entrega: en días naturales\n2. Forma de pago: 50% al pedido, 50% a la entrega\n3. Garantía: 2 años\n\nQuedaremos a la espera de su confirmación.',
                
                'Excel': 'PRESUPUESTO ANUAL 2024\n\nITEM\tCONCEPTO\tCANTIDAD\tPRECIO UNIT.\tTOTAL\n001\tServicios profesionales\t12\t2500\t30000\n002\tMaterial de oficina\t1\t1200\t1200\n003\tEquipamiento informático\t5\t800\t4000\n004\tGastos de desplazamiento\t24\t150\t3600\n\nTOTAL PRESUPUESTO: 38,800 €',
                
                'Imagen': 'DOCUMENTO ESCANEADO\n\nRESOLUCIÓN ADMINISTRATIVA\n\nVISTO: El expediente iniciado a solicitud de [NOMBRE] para [MOTIVO].\n\nCONSIDERANDO: Que se han cumplido todos los requisitos legales establecidos en la normativa vigente.\n\nRESOLVEMOS:\n\nPRIMERO.- Conceder la autorización solicitada.\nSEGUNDO.- Notificar al interesado.\nTERCERO.- Dar traslado al departamento correspondiente.'
            };
            
            return sampleTexts[fileType] || 'Contenido de texto extraído del archivo ' + file.name;
        }

        function performAnalysis(file, content) {
            const analysis = {
                fileName: file.name,
                fileType: getFileType(file.name),
                size: file.size,
                lastModified: new Date(file.lastModified),
                documentType: classifyDocument(content),
                structure: analyzeStructure(content),
                legalElements: extractLegalElements(content),
                formalChecklist: performFormalCheck(content),
                semanticAnalysis: performSemanticAnalysis(content),
                summary: generateSummary(content),
                riskLevel: assessRiskLevel(content),
                textContent: content.substring(0, 1000) + (content.length > 1000 ? '...' : '')
            };
            
            return analysis;
        }

        function classifyDocument(content) {
            const patterns = {
                'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.': /contrat[oa]|cl[aá]usul|acuerdo|partes|contratante|contratista/i,
                'Carta Comercial': /estimados|se[ñn]ores|salud[oa]|atentamente|cordialmente/i,
                'Resolución': /resoluci[oó]n|visto|considerando|resolvemos|dispongo/i,
                'Demanda': /demanda|juzgado|tribunal|actor|demandado|s[úu]plica/i,
                'Presupuesto': /presupuesto|importe|total|cantidad|precio|factura/i,
                'Informe': /informe|an[aá]lisis|conclusi[oó]n|recomendaci[oó]n/i
            };
            
            for (let type in patterns) {
                if (patterns[type].test(content)) {
                    return type;
                }
            }
            
            return 'Documento General';
        }

        function analyzeStructure(content) {
            const structure = {
                hasHeader: /^[A-ZÁÉÍÓÚÑ\s]{3,50}$/m.test(content),
                hasClauses: /cl[aá]usul|art[ií]cul|apartado|secci[oó]n/i.test(content),
                hasSignature: /firma|fdo\.|atentamente|cordialmente/i.test(content),
                hasDate: /\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}\s+de\s+\w+\s+de\s+\d{4}/i.test(content),
                paragraphs: content.split('\n\n').length,
                wordCount: content.split(/\s+/).length
            };
            
            return structure;
        }

        function extractLegalElements(content) {
            const elements = {
                laws: content.match(/ley\s+\d+\/\d+|real\s+decreto\s+\d+\/\d+|orden\s+\w+\/\d+/gi) || [],
                articles: content.match(/art[ií]culo\s+\d+|art\.\s*\d+/gi) || [],
                references: content.match(/en\s+virtud\s+de|de\s+conformidad\s+con|seg[uú]n\s+establece/gi) || [],
                dates: content.match(/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}\s+de\s+\w+\s+de\s+\d{4}/gi) || []
            };
            
            return elements;
        }

        function performFormalCheck(content) {
            const checks = [
                {
                    name: 'Encabezado presente',
                    passed: /^[A-ZÁÉÍÓÚÑ\s]{3,50}/m.test(content),
                    importance: 'alta'
                },
                {
                    name: 'Estructura de párrafos',
                    passed: content.split('\n\n').length > 2,
                    importance: 'media'
                },
                {
                    name: 'Fecha incluida',
                    passed: /\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}\s+de\s+\w+\s+de\s+\d{4}/i.test(content),
                    importance: 'alta'
                },
                {
                    name: 'Firma o cierre formal',
                    passed: /firma|fdo\.|atentamente|cordialmente/i.test(content),
                    importance: 'media'
                },
                {
                    name: 'Extensión adecuada',
                    passed: content.length > 100,
                    importance: 'baja'
                }
            ];
            
            return checks;
        }

        function performSemanticAnalysis(content) {
            const analysis = {
                tone: getTone(content),
                formality: getFormalityLevel(content),
                complexity: getComplexityLevel(content),
                keyTerms: extractKeyTerms(content),
                sentiment: getSentiment(content)
            };
            
            return analysis;
        }

        function getTone(content) {
            if (/urgente|inmediato|cr[ií]tico/i.test(content)) return 'Urgente';
            if (/formal|respetuosamente|atentamente/i.test(content)) return 'Formal';
            if (/amigable|cordial/i.test(content)) return 'Cordial';
            return 'Neutral';
        }

        function getFormalityLevel(content) {
            let score = 0;
            if (/usted|se[ñn]or[ía]a|don|do[ñn]a/i.test(content)) score += 2;
            if (/por\s+la\s+presente|mediante\s+el\s+presente/i.test(content)) score += 2;
            if (/atentamente|cordialmente|respetuosamente/i.test(content)) score += 1;
            
            if (score >= 4) return 'Muy Formal';
            if (score >= 2) return 'Formal';
            return 'Informal';
        }

        function getComplexityLevel(content) {
            const words = content.split(/\s+/);
            const avgWordLength = words.reduce((sum, word) => sum + word.length, 0) / words.length;
            const longSentences = content.split(/[.!?]/).filter(s => s.split(/\s+/).length > 20).length;
            
            if (avgWordLength > 8 || longSentences > 3) return 'Alta';
            if (avgWordLength > 6 || longSentences > 1) return 'Media';
            return 'Baja';
        }

        function extractKeyTerms(content) {
            const commonLegalTerms = [
                'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.', 'cláusula', 'acuerdo', 'partes', 'obligación', 'derecho',
                'responsabilidad', 'garantía', 'indemnización', 'resolución', 'incumplimiento',
                'notificación', 'procedimiento', 'jurisdicción', 'competencia', 'tribunal'
            ];
            
            return commonLegalTerms.filter(term => 
                new RegExp(term, 'i').test(content)
            );
        }

        function getSentiment(content) {
            const positiveWords = /satisfactorio|excelente|bueno|óptimo|correcto|adecuado/gi;
            const negativeWords = /problema|error|incorrecto|inadecuado|deficiente|insatisfactorio/gi;
            
            const positive = (content.match(positiveWords) || []).length;
            const negative = (content.match(negativeWords) || []).length;
            
            if (positive > negative) return 'Positivo';
            if (negative > positive) return 'Negativo';
            return 'Neutral';
        }

        function generateSummary(content) {
            const sentences = content.split(/[.!?]/).filter(s => s.trim().length > 20);
            const firstSentences = sentences.slice(0, 3).join('. ');
            return firstSentences.length > 200 ? 
                firstSentences.substring(0, 200) + '...' : 
                firstSentences;
        }

        function assessRiskLevel(content) {
            let riskScore = 0;
            
            // Factores de riesgo
            if (/incumplimiento|breach|violación|infracción/i.test(content)) riskScore += 3;
            if (/demanda|litigation|tribunal|juzgado/i.test(content)) riskScore += 3;
            if (/urgente|inmediato|plazo|vencimiento/i.test(content)) riskScore += 2;
            if (/penalización|multa|sanción/i.test(content)) riskScore += 2;
            if (/revisión|modificación|enmienda/i.test(content)) riskScore += 1;
            
            if (riskScore >= 6) return 'Alto';
            if (riskScore >= 3) return 'Medio';
            return 'Bajo';
        }

        function generateAnalysisResults() {
            const resultsContainer = document.getElementById('analysisResults');
            const checklistContainer = document.getElementById('checklistResults');
            const legalContainer = document.getElementById('legalFramework');
            const timelineContainer = document.getElementById('timeline');
            
            // Resultados de análisis
            let resultsHTML = '<h3>📊 Resultados del Análisis</h3>';
            
            Object.values(analysisResults).forEach(analysis => {
                const typeClass = getDocumentTypeClass(analysis.documentType);
                
                resultsHTML += `
                    <div class="summary-card">
                        <h4>📄 ${analysis.fileName}</h4>
                        <div class="document-type ${typeClass}">${analysis.documentType}</div>
                        <p><strong>Riesgo:</strong> <span class="risk-${analysis.riskLevel.toLowerCase()}">${analysis.riskLevel}</span></p>
                        <p><strong>Complejidad:</strong> ${analysis.semanticAnalysis.complexity}</p>
                        <p><strong>Tono:</strong> ${analysis.semanticAnalysis.tone}</p>
                        <p><strong>Resumen:</strong> ${analysis.summary}</p>
                        
                        <div style="margin-top: 15px;">
                            <strong>Elementos legales encontrados:</strong>
                            <ul style="margin: 5px 0 0 20px;">
                                <li>Leyes: ${analysis.legalElements.laws.length}</li>
                                <li>Artículos: ${analysis.legalElements.articles.length}</li>
                                <li>Referencias: ${analysis.legalElements.references.length}</li>
                            </ul>
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = resultsHTML;

            // Lista de verificación
            let checklistHTML = '';
            Object.values(analysisResults).forEach(analysis => {
                checklistHTML += `<h4>✅ ${analysis.fileName}</h4>`;
                analysis.formalChecklist.forEach(check => {
                    const icon = check.passed ? '✅' : '❌';
                    const statusClass = check.passed ? 'check-pass' : 'check-fail';
                    
                    checklistHTML += `
                        <div class="checklist-item">
                            <span class="checklist-icon ${statusClass}">${icon}</span>
                            <span>${check.name} (${check.importance})</span>
                        </div>
                    `;
                });
            });
            
            checklistContainer.innerHTML = checklistHTML;

            // Marco legal
            let legalHTML = '<h4>⚖️ Referencias Legales Identificadas</h4>';
            const allLaws = [];
            const allArticles = [];
            
            Object.values(analysisResults).forEach(analysis => {
                allLaws.push(...analysis.legalElements.laws);
                allArticles.push(...analysis.legalElements.articles);
            });
            
            const uniqueLaws = [...new Set(allLaws)];
            const uniqueArticles = [...new Set(allArticles)];
            
            legalHTML += `
                <div class="summary-card">
                    <h5>📚 Leyes y Decretos</h5>
                    ${uniqueLaws.length > 0 ? 
                        '<ul>' + uniqueLaws.map(law => `<li>${law}</li>`).join('') + '</ul>' :
                        '<p>No se encontraron referencias específicas a leyes.</p>'
                    }
                    
                    <h5>📖 Artículos</h5>
                    ${uniqueArticles.length > 0 ? 
                        '<ul>' + uniqueArticles.map(art => `<li>${art}</li>`).join('') + '</ul>' :
                        '<p>No se encontraron referencias específicas a artículos.</p>'
                    }
                </div>
            `;
            
            legalContainer.innerHTML = legalHTML;

            // Timeline
            let timelineHTML = '';
            const sortedResults = Object.values(analysisResults).sort((a, b) => 
                new Date(a.lastModified) - new Date(b.lastModified)
            );
            
            sortedResults.forEach(analysis => {
                timelineHTML += `
                    <div class="timeline-item">
                        <h5>${analysis.fileName}</h5>
                        <p><strong>Fecha:</strong> ${analysis.lastModified.toLocaleDateString()}</p>
                        <p><strong>Tipo:</strong> ${analysis.documentType}</p>
                        <p><strong>Estado:</strong> ${getDocumentStatus(analysis)}</p>
                    </div>
                `;
            });
            
            timelineContainer.innerHTML = timelineHTML;
        }

        function getDocumentTypeClass(type) {
            const classes = {
                'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.': 'type-contract',
                'Carta Comercial': 'type-letter',
                'Resolución': 'type-legal',
                'Demanda': 'type-legal',
                'Presupuesto': 'type-report',
                'Informe': 'type-report'
            };
            return classes[type] || 'type-legal';
        }

        function getDocumentStatus(analysis) {
            if (analysis.riskLevel === 'Alto') return '⚠️ Requiere Atención';
            if (analysis.formalChecklist.some(check => !check.passed && check.importance === 'alta')) {
                return '⚠️ Revisión Necesaria';
            }
            return '✅ Conforme';
        }

        function generateReports() {
            generateExecutiveSummary();
            generateDetailedReport();
        }

        function generateExecutiveSummary() {
            const container = document.getElementById('executiveSummary');
            const totalDocs = Object.keys(analysisResults).length;
            const riskDistribution = getRiskDistribution();
            const typeDistribution = getTypeDistribution();
            
            const summaryHTML = `
                <div class="summary-card">
                    <h4>📈 Estadísticas Generales</h4>
                    <p><strong>Total de documentos analizados:</strong> ${totalDocs}</p>
                    <p><strong>Documentos de alto riesgo:</strong> ${riskDistribution.Alto || 0}</p>
                    <p><strong>Documentos de medio riesgo:</strong> ${riskDistribution.Medio || 0}</p>
                    <p><strong>Documentos de bajo riesgo:</strong> ${riskDistribution.Bajo || 0}</p>
                    
                    <h5>📋 Distribución por Tipo</h5>
                    ${Object.entries(typeDistribution).map(([type, count]) => 
                        `<p><strong>${type}:</strong> ${count} documento(s)</p>`
                    ).join('')}
                    
                    <h5>⚠️ Recomendaciones Principales</h5>
                    <ul>
                        ${generateRecommendations().map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            container.innerHTML = summaryHTML;
        }

        function generateDetailedReport() {
            const container = document.getElementById('detailedReport');
            
            let detailedHTML = '<div class="summary-card">';
            
            Object.values(analysisResults).forEach(analysis => {
                detailedHTML += `
                    <div style="border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                        <h4>📄 ${analysis.fileName}</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                            <div>
                                <h5>📊 Información General</h5>
                                <p><strong>Tipo:</strong> ${analysis.documentType}</p>
                                <p><strong>Tamaño:</strong> ${formatFileSize(analysis.size)}</p>
                                <p><strong>Palabras:</strong> ${analysis.structure.wordCount}</p>
                                <p><strong>Párrafos:</strong> ${analysis.structure.paragraphs}</p>
                            </div>
                            
                            <div>
                                <h5>🎯 Análisis Semántico</h5>
                                <p><strong>Tono:</strong> ${analysis.semanticAnalysis.tone}</p>
                                <p><strong>Formalidad:</strong> ${analysis.semanticAnalysis.formality}</p>
                                <p><strong>Complejidad:</strong> ${analysis.semanticAnalysis.complexity}</p>
                                <p><strong>Sentimiento:</strong> ${analysis.semanticAnalysis.sentiment}</p>
                            </div>
                        </div>
                        
                        <h5>🔍 Términos Clave Identificados</h5>
                        <p>${analysis.semanticAnalysis.keyTerms.join(', ') || 'Ninguno'}</p>
                        
                        <h5>📝 Estructura del Documento</h5>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <span>Encabezado: ${analysis.structure.hasHeader ? '✅' : '❌'}</span>
                            <span>Cláusulas: ${analysis.structure.hasClauses ? '✅' : '❌'}</span>
                            <span>Firma: ${analysis.structure.hasSignature ? '✅' : '❌'}</span>
                            <span>Fecha: ${analysis.structure.hasDate ? '✅' : '❌'}</span>
                        </div>
                        
                        <h5>📋 Resumen del Contenido</h5>
                        <p style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-style: italic;">
                            ${analysis.summary}
                        </p>
                    </div>
                `;
            });
            
            detailedHTML += '</div>';
            container.innerHTML = detailedHTML;
        }

        function getRiskDistribution() {
            const distribution = {};
            Object.values(analysisResults).forEach(analysis => {
                distribution[analysis.riskLevel] = (distribution[analysis.riskLevel] || 0) + 1;
            });
            return distribution;
        }

        function getTypeDistribution() {
            const distribution = {};
            Object.values(analysisResults).forEach(analysis => {
                distribution[analysis.documentType] = (distribution[analysis.documentType] || 0) + 1;
            });
            return distribution;
        }

        function generateRecommendations() {
            const recommendations = [];
            const riskDistribution = getRiskDistribution();
            
            if (riskDistribution.Alto > 0) {
                recommendations.push(`Revisar urgentemente ${riskDistribution.Alto} documento(s) de alto riesgo`);
            }
            
            const formalIssues = Object.values(analysisResults).filter(a => 
                a.formalChecklist.some(check => !check.passed && check.importance === 'alta')
            ).length;
            
            if (formalIssues > 0) {
                recommendations.push(`${formalIssues} documento(s) requieren corrección de formato`);
            }
            
            const contractsCount = Object.values(analysisResults).filter(a => 
                a.documentType === 'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.'
            ).length;
            
            if (contractsCount > 0) {
                recommendations.push(`Verificar ${contractsCount} CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.(s) con asesoría legal especializada`);
            }
            
            if (recommendations.length === 0) {
                recommendations.push('Todos los documentos cumplen con los estándares básicos');
            }
            
            return recommendations;
        }

        function updateMemory() {
            // Actualizar memoria de documentos
            Object.values(analysisResults).forEach(analysis => {
                const key = analysis.fileName;
                documentMemory[key] = {
                    fileName: analysis.fileName,
                    type: analysis.documentType,
                    summary: analysis.summary,
                    keyTerms: analysis.semanticAnalysis.keyTerms,
                    riskLevel: analysis.riskLevel,
                    processedDate: new Date().toISOString(),
                    legalElements: analysis.legalElements
                };
            });
            
            // Actualizar base de conocimientos
            updateKnowledgeBase();
            
            // Mostrar memoria actualizada
            displayMemory();
        }

        function updateKnowledgeBase() {
            // Extraer términos y conceptos para la base de conocimientos
            const allTerms = [];
            const allLegalReferences = [];
            const documentTypes = new Set();
            
            Object.values(analysisResults).forEach(analysis => {
                allTerms.push(...analysis.semanticAnalysis.keyTerms);
                allLegalReferences.push(...analysis.legalElements.laws);
                allLegalReferences.push(...analysis.legalElements.articles);
                documentTypes.add(analysis.documentType);
            });
            
            knowledgeBase = {
                lastUpdated: new Date().toISOString(),
                totalDocuments: Object.keys(documentMemory).length,
                commonTerms: [...new Set(allTerms)],
                legalReferences: [...new Set(allLegalReferences)],
                documentTypes: [...documentTypes],
                patterns: extractPatterns(),
                statistics: {
                    avgComplexity: calculateAverageComplexity(),
                    riskDistribution: getRiskDistribution(),
                    typeDistribution: getTypeDistribution()
                }
            };
            
            displayKnowledgeBase();
        }

        function extractPatterns() {
            const patterns = {
                commonStructures: [],
                frequentClauses: [],
                riskIndicators: []
            };
            
            // Aquí se implementaría lógica más avanzada de ML
            // Por ahora, patrones básicos
            Object.values(analysisResults).forEach(analysis => {
                if (analysis.structure.hasClauses) {
                    patterns.commonStructures.push('Estructura con cláusulas');
                }
                if (analysis.riskLevel === 'Alto') {
                    patterns.riskIndicators.push(analysis.semanticAnalysis.keyTerms);
                }
            });
            
            return patterns;
        }

        function calculateAverageComplexity() {
            const complexityValues = { 'Baja': 1, 'Media': 2, 'Alta': 3 };
            const total = Object.values(analysisResults).reduce((sum, analysis) => 
                sum + complexityValues[analysis.semanticAnalysis.complexity], 0
            );
            const avg = total / Object.keys(analysisResults).length;
            
            if (avg >= 2.5) return 'Alta';
            if (avg >= 1.5) return 'Media';
            return 'Baja';
        }

        function displayMemory() {
            const container = document.getElementById('documentMemory');
            
            let memoryHTML = `
                <div class="summary-card">
                    <h4>📚 Documentos en Memoria (${Object.keys(documentMemory).length})</h4>
            `;
            
            Object.values(documentMemory).forEach(doc => {
                memoryHTML += `
                    <div style="border-left: 4px solid #007bff; padding: 15px; margin: 10px 0; background: #f8f9fa;">
                        <h5>${doc.fileName}</h5>
                        <p><strong>Tipo:</strong> ${doc.type}</p>
                        <p><strong>Riesgo:</strong> ${doc.riskLevel}</p>
                        <p><strong>Procesado:</strong> ${new Date(doc.processedDate).toLocaleString()}</p>
                        <p><strong>Resumen:</strong> ${doc.summary}</p>
                        <p><strong>Términos clave:</strong> ${doc.keyTerms.join(', ')}</p>
                    </div>
                `;
            });
            
            memoryHTML += '</div>';
            container.innerHTML = memoryHTML;
        }

        function displayKnowledgeBase() {
            const container = document.getElementById('knowledgeBase');
            container.textContent = JSON.stringify(knowledgeBase, null, 2);
        }

        function exportToPDF(type) {
            const content = getExportContent(type);
            
            // Crear elemento para descargar
            const element = document.createElement('a');
            const file = new Blob([content], { type: 'text/plain' });
            element.href = URL.createObjectURL(file);
            element.download = `informe_${type}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            showAlert('Informe exportado como archivo de texto (PDF requiere librería externa)', 'success');
        }

        function exportToWord(type) {
            const content = getExportContent(type);
            
            // Crear elemento para descargar
            const element = document.createElement('a');
            const file = new Blob([content], { type: 'text/plain' });
            element.href = URL.createObjectURL(file);
            element.download = `informe_${type}_${new Date().toISOString().split('T')[0]}.docx`;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            showAlert('Informe exportado como archivo de texto (DOCX requiere librería externa)', 'success');
        }

        function getExportContent(type) {
            const date = new Date().toLocaleDateString();
            let content = `INFORME DE ANÁLISIS DE DOCUMENTOS LEGALES\n`;
            content += `Fecha: ${date}\n`;
            content += `Tipo: ${type === 'summary' ? 'Resumen Ejecutivo' : 'Informe Detallado'}\n`;
            content += `${'='.repeat(60)}\n\n`;
            
            if (type === 'summary') {
                content += document.getElementById('executiveSummary').textContent;
            } else {
                content += document.getElementById('detailedReport').textContent;
            }
            
            content += `\n\n${'='.repeat(60)}\n`;
            content += `Generado por Analizador de Documentos Legales v1.0\n`;
            
            return content;
        }

        function exportMemoryJSON() {
            const memoryData = {
                documentMemory: documentMemory,
                knowledgeBase: knowledgeBase,
                exportDate: new Date().toISOString()
            };
            
            const element = document.createElement('a');
            const file = new Blob([JSON.stringify(memoryData, null, 2)], { type: 'application/json' });
            element.href = URL.createObjectURL(file);
            element.download = `memoria_documentos_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            showAlert('Memoria exportada exitosamente', 'success');
        }

        function loadMemoryJSON() {
            document.getElementById('memoryInput').click();
        }

        function loadMemoryFromFile(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.documentMemory) documentMemory = data.documentMemory;
                    if (data.knowledgeBase) knowledgeBase = data.knowledgeBase;
                    
                    displayMemory();
                    displayKnowledgeBase();
                    
                    showAlert('Memoria cargada exitosamente', 'success');
                } catch (error) {
                    showAlert('Error al cargar el archivo de memoria', 'danger');
                }
            };
            reader.readAsText(file);
        }

        function loadStoredMemory() {
            // En un entorno real, esto cargaría desde una base de datos
            // Por ahora, mantener memoria vacía al inicio
            displayMemory();
            displayKnowledgeBase();
        }

        function showLoadingState() {
            const loading = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Procesando documentos...</p>
                </div>
            `;
            
            document.getElementById('analysisResults').innerHTML = loading;
        }

        function hideLoadingState() {
            // Se oculta automáticamente al mostrar los resultados
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // Insertar al principio del contenedor actual
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);
            
            // Remover después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        // Funciones auxiliares adicionales
        function simulateAIResponse(prompt, context) {
            // Simulación de respuesta de IA para generar contra-argumentos o réplicas
            const responses = {
                'CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas.': 'Con respecto al CONTRATO; Documento Contractual generador de derechos y obligaciones, por su naturaleza, finalidad  condiciones, estas  son Bilaterales y  que se tienen por reproducidas. presentado, se sugiere revisar las cláusulas de responsabilidad y establecer límites más claros en cuanto a las obligaciones de cada parte.',
                'demanda': 'En relación a la demanda presentada, se recomienda preparar una contestación que incluya excepciones procesales y defensas de fondo basadas en la documentación disponible.',
                'carta': 'Respecto a la comunicación recibida, se sugiere una respuesta formal que aclare los puntos controvertidos y establezca una posición clara sobre los temas planteados.'
            };
            
            return responses[context] || 'Se requiere un análisis más detallado para proporcionar una respuesta específica.';
        }

        // Inicialización cuando se carga la página
        window.addEventListener('load', function() {
            showAlert('Sistema de análisis de documentos legales iniciado correctamente', 'success');
        });
    </script>
</body>
</html>
	<style>
        body {
          background: #E0EAFC;  /* fallback for old browsers */
	      background: -webkit-linear-gradient(to right, #CFDEF3, #E0EAFC);  /* Chrome 10-25, Safari 5.1-6 */
	      background: linear-gradient(to right, #CFDEF3, #E0EAFC); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

          color: #415B7E;
        }
        .sidebar {
          background-color: #FAFBF0;
        }
        .tag {
          background-color: #e3e2d1;
          color: #36190A;
        }
        .titulo-seccion {
          color: #001f92;
        }
        .destacado {
          color: #E7473C;
        }
    </style>
    </body>
</html>
